<html>
<head>
    <title>AWS Content Inspector</title>
    <link rel="icon" href="/static/BridgeApps-Logo-Only-300x300.png" sizes="192x192" />

    <link rel="stylesheet" type="text/css" href="/static/styles.css">

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/dataTables.jqueryui.min.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />

    <script src="/static/inspector.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.html5.min.js"></script>
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/2.3.2/js/buttons.print.min.js "></script>   

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>

    <script>
        $(document).ready( function () {


            $("#btnGetAllServices").on("click", function (event) {
                console.log("==> Starting to get all services info ");
                $("#btnGetAllServices").text('Loading ....');
                $("#btnGetAllServices").css("background-color","grey");
                $.ajax({
                        url: "/api/v1/aws/services/all",
                        type: "get",
                    }).done(function (result) {
                        console.log("==> Data received : " + result);
                        Table.clear().draw();
                        Table.rows.add(result).draw();

                        // reset button to same name
                        $("#btnGetAllServices").text('Get All AWS Services');
                        $("#btnGetAllServices").css("background-color","#4CAF50");

                    }).fail(function (jqXHR, textStatus, errorThrown) { 
                        console.log("Error while getting all services data : " + errorThrown);
                    });
                console.log("==> All Services Info received and table updated ");
            });

            $("#btnResetAll").on("click", function (event) {
                console.log("==> Startinng reset ");
                $("#btnResetAll").text('Loading ....');
                $("#btnResetAll").css("background-color","grey");
                $.ajax({
                        url: "/api/v1/aws/services/reset",
                        type: "get",
                    }).done(function (result) {

                        // reset button to same name
                        $("#btnResetAll").text('Reset Cache');
                        $("#btnResetAll").css("background-color","#4CAF50");

                    }).fail(function (jqXHR, textStatus, errorThrown) { 
                        console.log("Error while getting all services data : " + errorThrown);
                    });
                console.log("==> All Services Info received and table updated ");
            });

            $("#btnSetProfile").on("click", function (event) {
                
                var profileSelected = [$('#selectAwsProfile').val()];
                console.log("==> Starting to Set New Profile info " + profileSelected );
               
                $.ajax({
                        url: "/api/v1/aws/profile/" + profileSelected,
                        type: "POST",
                        data: JSON.stringify(profileSelected)
                    }).done(function (result) {
                        console.log("==> Data received : " + result);
                        showMessage(result);
                        getCurrentProfile();
                    }).fail(function (jqXHR, textStatus, errorThrown) { 
                        console.log("Error while getting all services data : " + errorThrown);
                    });
                console.log("==> Setting up of Profile completed ");
            });



            getAllAwsProfiles();
            getCurrentProfile();    
            drawTableOnScreen();
            $('#messages').hide();
        });
    
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <section class="pageheader">
                <h1>AWS Content Inspector </h1>
                <div class="row">
                    <div class="col-md-4"> Current AWS profile: <span id="currentAwsProfile"></span></div>
                    <div class="col-md-8 setProfile" style="text-align:right" >
                        <select id="selectAwsProfile" name="selectAwsProfile" class="secondary"></select>
                        <button id="btnSetProfile" name="btnSetProfile"  class="secondary"> Set Current Profile</button>
                    </div>
                </div>
            </section>

            <div id="messages" class="col-md-12"></div>
            
            <section class="pageFilters">
            <div class="col-md-12" style="text-align:right">
                <a href="/tree"><button id="btnGetAllServicesTree" name="btnGetAllServicesTree" class="secondary">Go to &lt; AWS Services as Tree View</button></a>
                <button id="btnGetAllServices" name="btnGetAllServices" class="primary">Get All AWS Services</button>

            </div>
            </section>
            <section class="pageBody">
            <div class="inspecttable">
                <table id="servicesTable" class="display compact" style="width:100%"> 
                    
                    <thead>
                        <th>VPCID</th>
                        <th>Service</th>
                        <th>ServiceId or ARN</th>
                        <th>Tag</th>
                        <th>Public IP</th>
                        <th>Private IP</th>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
            </section>

        </div>
    </div>

</body>
</html>